<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Î Î¿ÏÏ„Î¿Ï†ÏŒÎ»Î¹Î¿ ÎœÎµÏ„Î¿Ï‡ÏÎ½</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 { 
      text-align: center; 
      color: #2c3e50;
      margin-bottom: 30px;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #2980b9;
    }
    button.delete {
      background-color: #e74c3c;
    }
    button.delete:hover {
      background-color: #c0392b;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 8px;
      border: 1px solid #ddd;
      text-align: center;
    }
    th { 
      background: #2c3e50; 
      color: #fff; 
      font-weight: bold;
      position: sticky;
      top: 0;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    tr:hover {
      background-color: #f0f7ff;
    }
    input {
      width: 95%;
      padding: 8px 6px;
      border: 1px solid #ddd;
      border-radius: 3px;
      font-size: 14px;
    }
    input:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52,152,219,0.2);
    }
    input[type="number"] {
      text-align: right;
    }
    .summary {
      margin-top: 30px;
      background: #fff;
      padding: 20px;
      font-size: 18px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border-radius: 5px;
    }
    .summary strong {
      color: #2c3e50;
    }
    .summary div {
      margin: 10px 0;
    }
    .section-title {
      font-size: 20px;
      font-weight: bold;
      color: #2c3e50;
      margin: 25px 0 15px 0;
      border-bottom: 2px solid #3498db;
      padding-bottom: 5px;
    }
    .calculations-row {
      background-color: #f8f9fa;
      font-weight: bold;
    }
    #chart-container {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<h1>ğŸ“ˆ Î Î¿ÏÏ„Î¿Ï†ÏŒÎ»Î¹Î¿ ÎœÎµÏ„Î¿Ï‡ÏÎ½</h1>

<div class="controls">
  <button onclick="addRow()">â• Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÎœÎµÏ„Î¿Ï‡Î®Ï‚</button>
  <button onclick="saveData()" style="background-color: #27ae60;">ğŸ’¾ Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ·</button>
  <button onclick="clearAll()" class="delete">ğŸ—‘ï¸ ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚</button>
</div>

<div class="section-title">Î›ÎµÏ€Ï„Î¿Î¼Î­ÏÎµÎ¹ÎµÏ‚ Î‘Î³Î¿ÏÎ¬Ï‚ ÎœÎµÏ„Î¿Ï‡ÏÎ½</div>

<table id="portfolioTable">
  <thead>
    <tr>
      <th>Î‘/Î‘</th>
      <th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± Î‘Î³Î¿ÏÎ¬Ï‚</th>
      <th>ÎŒÎ½Î¿Î¼Î± ÎœÎµÏ„Î¿Ï‡Î®Ï‚</th>
      <th>Î¤ÎµÎ¼Î¬Ï‡Î¹Î±</th>
      <th>Î¤Î¹Î¼Î® Î‘Î³Î¿ÏÎ¬Ï‚/Ï„ÎµÎ¼. (â‚¬)</th>
      <th>Î‘Î¾Î¯Î± Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)</th>
      <th>Î ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)</th>
      <th>Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)</th>
      <th>Î”Î¹Î±Î³ÏÎ±Ï†Î®</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="section-title">Î£ÏÎ½Î¿Î»Î± & Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯</div>

<table id="calculationsTable">
  <thead>
    <tr>
      <th>Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î‘Î¾Î¯Î± Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)</th>
      <th>Î£Ï…Î½Î¿Î»Î¹ÎºÎ® Î ÏÎ¿Î¼Î®Î¸ÎµÎ¹Î± (â‚¬)</th>
      <th>Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)</th>
      <th>ÎœÎ­ÏƒÎ· Î¤Î¹Î¼Î®/Ï„ÎµÎ¼. (â‚¬)</th>
      <th>Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÎ­ÏÎ´Î¿Ï‚/Î–Î·Î¼Î¹Î¬ (â‚¬)</th>
      <th>Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ ÎšÎ­ÏÎ´Î¿Ï…Ï‚/Î–Î·Î¼Î¹Î¬Ï‚ (%)</th>
    </tr>
  </thead>
  <tbody>
    <tr class="calculations-row">
      <td id="totalPurchaseValue">0.00</td>
      <td id="totalCommission">0.00</td>
      <td id="totalCost">0.00</td>
      <td id="averagePrice">0.00</td>
      <td id="totalPL">0.00</td>
      <td id="totalPLPercent">0.00</td>
    </tr>
  </tbody>
</table>

<div class="summary" id="summary"></div>

<div id="chart-container">
  <canvas id="chart" height="100"></canvas>
</div>

<script>
let chart;
let rowCounter = 1;

function addRow(data = {}) {
  const tbody = document.querySelector('#portfolioTable tbody');
  const row = document.createElement('tr');
  const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD

  row.innerHTML = `
    <td>${rowCounter}</td>
    <td><input type="date" value="${data.date || currentDate}" /></td>
    <td><input value="${data.name || ''}" placeholder="Ï€.Ï‡. Apple Inc." /></td>
    <td><input type="number" min="0" step="1" value="${data.qty || 0}" /></td>
    <td><input type="number" min="0" step="0.01" value="${data.buyPrice || 0.00}" /></td>
    <td class="purchaseValue">0.00</td>
    <td><input type="number" min="0" step="0.01" value="${data.commission || 0.00}" /></td>
    <td class="totalCost">0.00</td>
    <td><button onclick="deleteRow(this)" class="delete" style="padding: 5px 10px;">âœ•</button></td>
  `;

  tbody.appendChild(row);
  rowCounter++;
  
  // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· event listeners ÏƒÏ„Î± input Ï€ÎµÎ´Î¯Î±
  row.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', calculate);
  });
  
  calculate();
}

function deleteRow(button) {
  const row = button.closest('tr');
  row.remove();
  
  // Î•Ï€Î±Î½Î±ÏÎ¯Î¸Î¼Î·ÏƒÎ· Î‘/Î‘
  const rows = document.querySelectorAll('#portfolioTable tbody tr');
  rows.forEach((row, index) => {
    row.querySelector('td:first-child').textContent = index + 1;
  });
  rowCounter = rows.length + 1;
  
  calculate();
}

function calculate() {
  let totalPurchaseValue = 0;
  let totalCommission = 0;
  let totalCost = 0;
  let totalShares = 0;
  
  const rows = document.querySelectorAll('#portfolioTable tbody tr');
  
  rows.forEach(row => {
    const inputs = row.querySelectorAll('input');
    const date = inputs[0].value;
    const name = inputs[1].value;
    const qty = Number(inputs[2].value) || 0;
    const buyPrice = Number(inputs[3].value) || 0;
    const commission = Number(inputs[4].value) || 0;
    
    const purchaseValue = qty * buyPrice;
    const rowTotalCost = purchaseValue + commission;
    
    row.querySelector('.purchaseValue').innerText = purchaseValue.toFixed(2);
    row.querySelector('.totalCost').innerText = rowTotalCost.toFixed(2);
    
    totalPurchaseValue += purchaseValue;
    totalCommission += commission;
    totalCost += rowTotalCost;
    totalShares += qty;
  });
  
  // Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î¼Î­ÏƒÎ·Ï‚ Ï„Î¹Î¼Î®Ï‚ Î±Î½Î¬ Ï„ÎµÎ¼Î¬Ï‡Î¹Î¿
  const averagePrice = totalShares > 0 ? totalCost / totalShares : 0;
  
  // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Ï‰Î½ ÎºÎµÎ»Î¹ÏÎ½ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏÎ½
  document.getElementById('totalPurchaseValue').innerText = totalPurchaseValue.toFixed(2);
  document.getElementById('totalCommission').innerText = totalCommission.toFixed(2);
  document.getElementById('totalCost').innerText = totalCost.toFixed(2);
  document.getElementById('averagePrice').innerText = averagePrice.toFixed(2);
  
  // Î“Î¹Î± Ï„ÏÏÎ±, Ï„Î¿ ÎºÎ­ÏÎ´Î¿Ï‚/Î¶Î·Î¼Î¯Î± ÎµÎ¯Î½Î±Î¹ 0 (Î¸Î± Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯ Î¼ÎµÎ»Î»Î¿Î½Ï„Î¹ÎºÎ¬)
  const currentValue = totalPurchaseValue; // Î ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î¯Î´Î¹Î¿ Î¼Îµ Ï„Î·Î½ Î±Î¾Î¯Î± Î±Î³Î¿ÏÎ¬Ï‚
  const totalPL = currentValue - totalCost;
  const totalPLPercent = totalCost > 0 ? (totalPL / totalCost * 100) : 0;
  
  document.getElementById('totalPL').innerText = totalPL.toFixed(2);
  document.getElementById('totalPLPercent').innerText = totalPLPercent.toFixed(2) + '%';
  
  // Î•Î½Î·Î¼Î­ÏÏ‰ÏƒÎ· Ï„Î¿Ï… summary
  updateSummary(totalPurchaseValue, totalCommission, totalCost, totalPL);
  
  // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
  createChart(rows);
  
  // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Ï‰Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½
  saveToLocalStorage();
}

function updateSummary(purchaseValue, commission, totalCost, pl) {
  const summary = document.getElementById('summary');
  summary.innerHTML = `
    <div><strong>Î£ÏÎ½Î¿Î»Î¿ Î‘Î¾Î¯Î±Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚:</strong> â‚¬${purchaseValue.toFixed(2)}</div>
    <div><strong>Î£ÏÎ½Î¿Î»Î¿ Î ÏÎ¿Î¼Î·Î¸ÎµÎ¹ÏÎ½:</strong> â‚¬${commission.toFixed(2)}</div>
    <div><strong>Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚:</strong> â‚¬${totalCost.toFixed(2)}</div>
    <div><strong>Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î‘Î¾Î¯Î±:</strong> â‚¬${purchaseValue.toFixed(2)} (Ï€ÏÎ¿ÏƒÏ‰ÏÎ¹Î½Î¬ Î¯Î´Î¹Î± Î¼Îµ Î±Î¾Î¯Î± Î±Î³Î¿ÏÎ¬Ï‚)</div>
    <div><strong>Î£Ï…Î½Î¿Î»Î¹ÎºÏŒ ÎšÎ­ÏÎ´Î¿Ï‚/Î–Î·Î¼Î¯Î±:</strong> <span style="color: ${pl >= 0 ? 'green' : 'red'}">â‚¬${pl.toFixed(2)}</span></div>
  `;
}

function createChart(rows) {
  const ctx = document.getElementById('chart');
  
  // ÎšÎ±Ï„Î±ÏƒÏ„ÏÎ¿Ï†Î® Ï„Î¿Ï… Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï… Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚ Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹
  if (chart) {
    chart.destroy();
  }
  
  // Î£Ï…Î»Î»Î¿Î³Î® Î´ÎµÎ´Î¿Î¼Î­Î½Ï‰Î½ Î³Î¹Î± Ï„Î¿ Î³ÏÎ¬Ï†Î·Î¼Î±
  const labels = [];
  const data = [];
  const colors = [];
  
  rows.forEach((row, index) => {
    const name = row.querySelector('input[type="text"]').value;
    const totalCost = parseFloat(row.querySelector('.totalCost').innerText);
    
    if (name && totalCost > 0) {
      labels.push(name || `ÎœÎµÏ„Î¿Ï‡Î® ${index + 1}`);
      data.push(totalCost);
      
      // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¿Ï Ï‡ÏÏÎ¼Î±Ï„Î¿Ï‚ Î³Î¹Î± ÎºÎ¬Î¸Îµ ÏÎ¬Î²Î´Î¿
      const hue = (index * 137) % 360; // Î§ÏÎ®ÏƒÎ· Ï‡ÏÏ…ÏƒÎ®Ï‚ Î³Ï‰Î½Î¯Î±Ï‚ Î³Î¹Î± Î´Î¹Î±Ï†Î¿ÏÎµÏ„Î¹ÎºÎ¬ Ï‡ÏÏÎ¼Î±Ï„Î±
      colors.push(`hsl(${hue}, 70%, 60%)`);
    }
  });
  
  // Î•Î¬Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±, ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Î¼Î·Î½ÏÎ¼Î±Ï„Î¿Ï‚
  if (labels.length === 0) {
    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±'],
        datasets: [{
          label: 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)',
          data: [0],
          backgroundColor: '#e0e0e0'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚ Î‘Î½Î¬ ÎœÎµÏ„Î¿Ï‡Î®'
          }
        }
      }
    });
    return;
  }
  
  // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î½Î­Î¿Ï… Î³ÏÎ±Ï†Î®Î¼Î±Ï„Î¿Ï‚
  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚ (â‚¬)',
        data: data,
        backgroundColor: colors,
        borderColor: colors.map(color => color.replace('60%)', '40%)')),
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: {
          display: true,
          text: 'ÎšÏŒÏƒÏ„Î¿Ï‚ Î‘Î³Î¿ÏÎ¬Ï‚ Î‘Î½Î¬ ÎœÎµÏ„Î¿Ï‡Î®'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'ÎšÏŒÏƒÏ„Î¿Ï‚ (â‚¬)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'ÎœÎµÏ„Î¿Ï‡Î­Ï‚'
          }
        }
      }
    }
  });
}

function saveToLocalStorage() {
  const data = [];
  document.querySelectorAll('#portfolioTable tbody tr').forEach(row => {
    const inputs = row.querySelectorAll('input');
    data.push({
      date: inputs[0].value,
      name: inputs[1].value,
      qty: inputs[2].value,
      buyPrice: inputs[3].value,
      commission: inputs[4].value
    });
  });
  localStorage.setItem('stockPortfolio', JSON.stringify(data));
}

function loadFromLocalStorage() {
  const data = JSON.parse(localStorage.getItem('stockPortfolio') || '[]');
  if (data.length === 0) {
    addRow(); // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î¼Î¹Î±Ï‚ ÎºÎµÎ½Î®Ï‚ Î³ÏÎ±Î¼Î¼Î®Ï‚ Î±Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´ÎµÎ´Î¿Î¼Î­Î½Î±
  } else {
    data.forEach(d => addRow(d));
  }
}

function saveData() {
  saveToLocalStorage();
  alert('Î¤Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎ±Î½ ÎµÏ€Î¹Ï„Ï…Ï‡ÏÏ‚!');
}

function clearAll() {
  if (confirm('Î•Î¯ÏƒÏ„Îµ Î²Î­Î²Î±Î¹Î¿Ï‚ ÏŒÏ„Î¹ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î´Î¹Î±Î³ÏÎ¬ÏˆÎµÏ„Îµ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±;')) {
    const tbody = document.querySelector('#portfolioTable tbody');
    tbody.innerHTML = '';
    rowCounter = 1;
    localStorage.removeItem('stockPortfolio');
    calculate();
    alert('ÎŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± Î´Î¹Î±Î³ÏÎ¬Ï†Ï„Î·ÎºÎ±Î½.');
  }
}

// Î‘ÏÏ‡Î¹ÎºÎ¿Ï€Î¿Î¯Î·ÏƒÎ·
document.addEventListener('DOMContentLoaded', function() {
  loadFromLocalStorage();
});
</script>

</body>
</html>
